# download hits from blast query
# create python loop to separate proteins from hits, using locations
# use python script to filter out low quality alignments (using E value 10^-10)
# dos2windows on files to make sure in correct format
# use vim to check \\t annotations

#run on command line (no script)
bedtoools subtract proteins.txt blastlocations.txt > ../results/subtracted areas

module load nano
module load bedtools
mkdir input
mkdir results
### @input ####
300419_hits.txt #file dowloaded from NCBI Blast hits
#use Proteins.pynb tool to extract protein locations from hit table.

300419_proteins.txt #protein locations table.
#open previous file in excel and just kept scaffold column and coordinates. save as 
300419_protein_corrected.txt 

#reorder file into increasing length order / reorder reverse and forward strand in
#ascending columns

awk '{OFS="\t"; if ($3>$2) {print} else {print $1,$3,$2}}'300419_protein_corrected.txt >
300419_proteins_corrected.bed 

 #to convert windows file into unix file
dos2unix 300419_proteins_corrected.bed

#make sure no wierd text markers that will impair bedtools from reading the file
vim 300419_proteins_corrected.bed
%s/^M/ #use vim to remove '^M' (ctrl V + shift M to get right format)

#same process for hits.txt & filter hits by 10e-10 e-value
300419_blast.txt #contains just blast hits, generated using python tool

#manualy extract columns needed for analysis; scaffold,identity and positions and save as
300419_hits_corrected.txt

#filter file to obtain good quality mapping reads
awk '{OFS="\t"; if ($4>10e-10) {print}}' 300419_hits_corrected.txt > 300419_filtered.txt

awk '{OFS="\t"; if ($3>$2){print $1,$2,$3} else {print
$1,$3,$3}}' 300419_filtered.txt > 300419_corrected_filtered_hits.bed 
dos2unix 300419_corrected_filtered_hits.bed  #to convert windows file to UNIX
vim 300419_corrected.bed
%s/^M/ #in vim to remove ^M

#run bedtools subtract with only >50% overlap
bedtools subtract -f 0.5 -a 300419_corrected_filtered_hits.bed -b 300419_proteins_corrected.bed > ../results/300419_subtracted_areas.bed

